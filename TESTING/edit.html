<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous">
      <link rel="stylesheet" href="../CSS/home.css">
      <link rel="stylesheet" href="../CSS/form.css">
</head>
<body>

    <div class="navbar-container">
        <div class="vertical-navbar">
            <a href="../index.html" title="Home">
              <img src="../IMAGES/homeicon.png" class="vert-nav-images" alt="Home">
              Home
          </a>
            <a href="./form.html" title="Submit">
          <img src="../IMAGES/submiticon.png"  class="vert-nav-images" alt="Submit">
              Submit
          </a>
            <a href="./view.html" title="View">
          <img src="../IMAGES/viewicon.png" class="vert-nav-images" alt="View">
              View
          </a>
            <a href="./edit.html" style="color: blue;" title="Edit">
              <img src="../IMAGES/editicon.png"  class="vert-nav-images" alt="">
              Edit</a>
          <a href="./profile.html" title="Profile">
              <img src="../IMAGES/defaultpfpicon.png" class="vert-nav-images" alt="Profile">
              Profile</a>
        </div>
  
        <div class="horizontal-navbar">
            <div id="greet"></div>
            <button class="btn btn-outline-success" type="button" id="signoutbutton">Sign Out</button>
        </div>
    </div>

    <div class="content">
        <h1>Edit Submission Form</h1>
        <form id="editForm">
            <fieldset>
                <legend><span class="section">1</span>Partner Info:</legend>
                <label for="editFname">First Name:</label>
                <input type="text" id="editFname" required />

                <label for="editLname">Last Name:</label>
                <input type="text" id="editLname" required />

                <label for="editEmail">Contact Email:</label>
                <input type="email" id="editEmail" required />

                <label for="editNumber">Contact Number:</label>
                <input type="text" id="editNumber" required />
            </fieldset>

            <fieldset>
                <legend><span class="section">2</span>Organization Info:</legend>
                <label for="editN_organization">Name of Organization:</label>
                <textarea id="editN_organization" required></textarea>
                
                <label for="editS_organization">Street Address:</label>
                <textarea id="editS_organization" required></textarea>

                <label for="editC_organization">City:</label>
                <textarea id="editC_organization" required></textarea>

                <label for="editST_organization">State:</label>
                <textarea id="editST_organization" required></textarea>

                <label for="editResources">Resources Available:</label>
                <textarea id="editResources" required></textarea>

                <label for="editAdditional">Additional Information:</label>
                <textarea id="editAdditional" required></textarea>
            </fieldset>

            <button class="registerbutton type="submit">Update</button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyAHcabQDigUfzFQ63dy_kjiaqAPZB4edtI",
    authDomain: "codinganddevelopment-e7d2c.firebaseapp.com",
    databaseURL: "https://codinganddevelopment-e7d2c-default-rtdb.firebaseio.com",
    projectId: "codinganddevelopment-e7d2c",
    storageBucket: "codinganddevelopment-e7d2c.appspot.com",
    messagingSenderId: "991250122571",
    appId: "1:991250122571:web:25d3ea280f9b9c34db8ace"
  };

        initializeApp(firebaseConfig);
        const database = getDatabase();



        function getQueryParam(name) {
            const urlSearchParams = new URLSearchParams(window.location.search);
            return urlSearchParams.get(name);
        }
        const formId = getQueryParam('id');  // Retrieve the unique identifier from URL

        // Function to populate the form with data from Firebase
        function loadFormData() {
            if (!formId) {
                console.error("No form ID provided.");
                return;
            }
            const dataRef = ref(database, 'Information/' + formId);
            get(dataRef).then((snapshot) => {
                if (snapshot.exists()) {
                    let data = snapshot.val();
                    // Populate form fields
                    document.getElementById('editFname').value = data.Fname;
                    document.getElementById('editLname').value = data.Lname;
                    document.getElementById('editEmail').value = data.email;
                    document.getElementById('editNumber').value = data.number;
                    document.getElementById('editN_organization').value = data.organization;
                    document.getElementById('editS_organization').value = data.S_organization;
                    document.getElementById('editC_organization').value = data.C_organization;
                    document.getElementById('editST_organization').value = data.ST_organization;
                    document.getElementById('editResources').value = data.resources;
                    document.getElementById('editAdditional').value = data.additional;
                } else {
                    console.log("No data available");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        // Function to update data in Firebase
function updateFormData(e) {
    e.preventDefault();

    // Get values from form fields
    let Fname = document.getElementById('editFname').value;
    let Lname = document.getElementById('editLname').value;
    let email = document.getElementById('editEmail').value;
    let number = document.getElementById('editNumber').value;
    let N_organization = document.getElementById('editN_organization').value;
    let S_organization = document.getElementById('editS_organization').value;
    let C_organization = document.getElementById('editC_organization').value;
    let ST_organization = document.getElementById('editST_organization').value;
    let resources = document.getElementById('editResources').value;
    let additional = document.getElementById('editAdditional').value;

    const updateRef = ref(database, 'Information/' + formId);
    update(updateRef, {
        Fname: Fname,
        Lname: Lname,
        email: email,
        number: number,
        organization: N_organization,
        S_organization: S_organization,
        C_organization: C_organization,
        ST_organization: ST_organization,
        resources: resources,
        additional: additional
    }).then(() => {
        alert("Data updated successfully");
        // Optional: Redirect to another page or indicate success in another way
    }).catch((error) => {
        console.error("Update failed: " + error.message);
    });
}


        window.onload = function() {
            loadFormData();
            document.getElementById('editForm').addEventListener('submit', updateFormData);
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script>
        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

        let GreetHead = document.getElementById('greet');
        let SignoutBtn = document.getElementById('signoutbutton');


        let Signout = () => {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = 'login.html'
        }

        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds")) {
                window.location.href = 'login.html';
            } else {
                GreetHead.innerText = `Welcome ${UserInfo.firstname} ${UserInfo.lastname}!`;
            }
        }

        window.addEventListener('load', CheckCred);
        SignoutBtn.addEventListener('click', Signout);
    </script>
</body>
</html>
