<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous">
    <link rel="stylesheet" href="../CSS/view.css">
    <link rel="stylesheet" href="../CSS/home.css">
    <link rel="icon" type="image/x-icon" href="../IMAGES/favicon.ico">
</head>

<body>

    <div class="navbar-container">
        <div class="vertical-navbar">
            <a href="../index.html" title="Home">
              <img src="../IMAGES/homeicon.png" class="vert-nav-images" alt="Home">
              Home
          </a>
            <a href="./form.html" title="Submit">
          <img src="../IMAGES/submiticon.png" class="vert-nav-images" alt="Submit">
              Submit
          </a>
            <a href="./view.html" style="color: blue;" title="View">
          <img src="../IMAGES/viewicon.png"   class="vert-nav-images" alt="View">
              View
          </a>
            <a href="./edit.html" title="Edit">
              <img src="../IMAGES/editicon.png" class="vert-nav-images" alt="">
              Edit</a>
          <a href="./profile.html" title="Profile">
              <img src="../IMAGES/defaultpfpicon.png" class="vert-nav-images" alt="Profile">
              Profile</a>
        </div>
  
        <div class="horizontal-navbar">
            <div id="greet"></div>
            <button class="btn btn-outline-success" type="button" id="signoutbutton">Sign Out</button>
        </div>
    </div>

    <div class="filter-search-container">
        <input type="text" id="searchInput" placeholder="Search...">
        <select id="stateFilter">
            <option value="">Select State</option>
        </select>
        <select id="cityFilter">
            <option value="">Select City</option>
        </select>
        <select id="sortFilter">
            <option value="">Sort By</option>
            <option value="name-asc">Name A-Z</option>
            <option value="name-desc">Name Z-A</option>
        </select>        
        <button id="filterButton">Filter</button>
    </div>
    

    <div class="custom-content">
        <div class="data-container" id="data-container">
            <table>
                <thead>
                </thead>
                <tbody id="tbody1">

                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAHcabQDigUfzFQ63dy_kjiaqAPZB4edtI",
            authDomain: "codinganddevelopment-e7d2c.firebaseapp.com",
            databaseURL: "https://codinganddevelopment-e7d2c-default-rtdb.firebaseio.com",
            projectId: "codinganddevelopment-e7d2c",
            storageBucket: "codinganddevelopment-e7d2c.appspot.com",
            messagingSenderId: "991250122571",
            appId: "1:991250122571:web:25d3ea280f9b9c34db8ace"
        };

        const app = initializeApp(firebaseConfig);

        let allData = [];
let uniqueStates = new Set();
let uniqueCities = new Set();

function SelectAllData() {
    const db = getDatabase(app);
    const dbRef = ref(db, 'Information');

    // Fetch the data snapshot before iterating
    get(dbRef).then((snapshot) => {
        snapshot.forEach((childSnapshot) => {
            const CurrentRecord = childSnapshot.val();
            allData.push(CurrentRecord);
            uniqueStates.add(CurrentRecord.ST_organization);
            uniqueCities.add(CurrentRecord.C_organization);
            
            const {
                Fname,
                Lname,
                email,
                number,
                organization,
                S_organization,
                C_organization,
                ST_organization,
                resources,
                additional
            } = CurrentRecord;

            AddItemsToTable(
                Fname,
                Lname,
                email,
                number,
                organization,
                S_organization,
                C_organization,
                ST_organization,
                resources,
                additional
            );
        });

        populateDropdown('stateFilter', uniqueStates);
        populateDropdown('cityFilter', uniqueCities);
    });
}

document.getElementById('filterButton').addEventListener('click', applyFilters);


function populateDropdown(dropdownId, optionsSet) {
    const dropdown = document.getElementById(dropdownId);
    // Clear existing options
    dropdown.innerHTML = '<option value="">Select ' + (dropdownId === 'stateFilter' ? 'State' : 'City') + '</option>';
    optionsSet.forEach((option) => {
        let opt = document.createElement('option');
        opt.value = option;
        opt.innerText = option;
        dropdown.appendChild(opt);
    });
}

    window.onload = SelectAllData;


  function AddItemsToTable(
            Fname,
            Lname,
            email,
            number,
            organization,
            S_organization,
            C_organization,
            ST_organization,
            resources,
            additional
        ) {
            var dataContainer = document.createElement('div');
            dataContainer.classList.add('data-item');

            // Create and append label-value pairs to the data container
            createLabelValue('First Name:', Fname);
            createLabelValue('Last Name:', Lname);
            createLabelValue('Email:', email);
            createLabelValue('Phone Number:', number);
            createLabelValue('Organization Name:', organization);
            createLabelValue('Street Address:', S_organization);
            createLabelValue('City:', C_organization);
            createLabelValue('State:', ST_organization);
            createLabelValue('Resources:', resources);
            createLabelValue('Additional Info:', additional);

            // Repeat for each label and value

            // Append the data container to the data-container div
            document.getElementById('data-container').appendChild(dataContainer);

            function createLabelValue(label, value) {
                var labelDiv = document.createElement('div');
                labelDiv.classList.add('data-label');
                labelDiv.innerText = label;

                var valueDiv = document.createElement('div');
                valueDiv.classList.add('data-value');
                valueDiv.innerText = value;

                dataContainer.appendChild(labelDiv);
                dataContainer.appendChild(valueDiv);
            }
        }

        function applyFilters() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const stateFilter = document.getElementById('stateFilter').value;
    const cityFilter = document.getElementById('cityFilter').value;
    const sortFilter = document.getElementById('sortFilter').value;

    let filteredData = allData.filter(item => {
        const matchesState = item.ST_organization === stateFilter || stateFilter === '';
        const matchesCity = item.C_organization === cityFilter || cityFilter === '';
        const matchesSearch = item.Fname.toLowerCase().includes(searchInput) ||
                              item.Lname.toLowerCase().includes(searchInput) ||
                              item.email.toLowerCase().includes(searchInput) ||
                              item.organization.toLowerCase().includes(searchInput) ||
                              item.number.includes(searchInput);
        return matchesState && matchesCity && matchesSearch;
    });

    // Sort the filtered data based on the selected sorting option
    if (sortFilter === 'name-asc') {
        filteredData.sort((a, b) => a.Fname.localeCompare(b.Fname));
    } else if (sortFilter === 'name-desc') {
        filteredData.sort((a, b) => b.Fname.localeCompare(a.Fname));
    }

    displayFilteredData(filteredData);
}

function displayFilteredData(data) {
    // Clear existing data display
    document.getElementById('data-container').innerHTML = '';

    // Add filtered data to the display
    data.forEach(item => {
        // Ensure the properties match those expected by AddItemsToTable
        AddItemsToTable(
            item.Fname,
            item.Lname,
            item.email,
            item.number,
            item.organization,
            item.S_organization,
            item.C_organization,
            item.ST_organization,
            item.resources,
            item.additional
        );
    });
}




    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script>
        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

        let GreetHead = document.getElementById('greet');
        let SignoutBtn = document.getElementById('signoutbutton');


        let Signout = () => {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = 'login.html'
        }

        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds")) {
                window.location.href = 'login.html';
            } else {
                GreetHead.innerText = `Welcome ${UserInfo.firstname} ${UserInfo.lastname}!`;
            }
        }

        window.addEventListener('load', CheckCred);
        SignoutBtn.addEventListener('click', Signout);
    </script>


</body>

</html>
